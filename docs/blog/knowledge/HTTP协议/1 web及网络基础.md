# web 及网络基础

1. 网络基础`TCP/IP` 协议族

   - 不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则。而我们就把这种规则称为协议（protocol）
   - `TCP/IP`协议族，有了分层结构，总共分为下面四层 从上往下
     - 应用层:   应用层决定了向用户提供应用服务时通信的活动。  
       - FTP 文件传输协议
       - DNS域名系统
       - HTTP协议
     - 传输层:   传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。
       - TCP 传输控制协议
       - UDP 用户数据报协议
     - 网络层：网络互联层，用于处理在网络上流动的数据包，数据包是网络传输的最小数据单位，该层规定了通过怎样的传输路线，到达对方的计算机，并把数据包传送给对方。
     - 链路层：又名网络接口层，数据链路层，用来处理网络的硬件部分。
       - 操作系统
       - 硬件的设备驱动
       - NIC 网卡
       - 光纤

2. TCP/IP 通信传输流

   ```javascript
   1. 客户端 发送
   
     HTTP客户端（应用层） --->   TCP(传输层)  --->  IP(网络层)  ---> 网络(链路层)
   
     // 其实在每一层 客户端都会给打上自己这一层的标记，包裹到上面，然后传输到下一层  就像 套娃一样   
   
   2. 服务器 接收
   
     网络(链路层)  --->   IP(网络层)  ---> TCP(传输层)  --->  HTTP服务器(应用层)
   
    // 服务器接收的时候，就会把套娃一个一个的揭开，拿到最里面一层的数据
   
            ( 以太网首部  ( IP首部 ( TCP首部( (HTTP数据) ) ) ) )
   
   
    # 可以看到，客户端是从上往下走， 而服务器 是从下往上走
   ```

   

3.  与HTTP 密切相关的协议： IP协议、TCP协议、DNS协议

   - IP 协议 （Internet Protocol）

     - 这里的IP 协议 不是IP地址， IP 地址只是IP协议的一部分
     - 位于网络层，从上往下的第三层
     - IP 协议的作用是，是把各种数据包传送给对方，要确保确实能够传送到对方那里，需要满足各类条件其中最重要的两个是
       - IP地址： 指明了节点被分配到的地址。IP 地址可以和MAC地址进行匹配，IP地址可以变换
       - MAC地址：指网卡所属的固定的地址。MAC地址一般轻易不会改变的
     - 如何根据IP 地址来查出对应的MAC地址，这个时候就需要用到ARP协议（Address Resolution Protocol）地址解析协议

   - TCP协议

     - TCP协议位于传输层，也就是从上往下的第二层。

     - TCP 提供可靠的字节流服务

       - 可靠是指，能够把数据准确的传递给对方。
       - 字节流服务，是指，为了方便传输，将大块数据割成以报文段为单位的数据包进行管理。

     - 为了准确无误的将数据送达到目标处  **TCP协议采用了三次握手策略**， 使用SYN 和 ACK 两个标志：  其实就是为了知道双方的接收和发送都是正常的

       - 发送端，发送一个带SYN标志的数据给接收端。SYN=1  顺序号seq = x    此时 服务器，知道自己接收正常，    完成第一次握手

       - 接收端，接收后，回带一个SYN/ACK 标记的数据包以示，此时 SYN = 1  ACK =  1   seq = y   ack =  x + 1    客户端知道自己发送、接收正常，服务器接收、发送正常   完成第二次握手

       - 发送端，拿到SYN/ACK 之后 ， 发送一个带 ACK标记的数据包给接收端，  .seq=x+1,ACK=1,ack=y+1  服务器知道客户端发送，接收正常，自己接收，发送也正常   代表握手结束。 完成第三次握手

         ```javascript
         # 简单说明一下 为啥需要三次握手，  主要的目的就是为了证明，发送端 和 接收端   的    发送和接收功能  都是正常的
         
          // ACK：确认序号的标志，ACK=1表示确认号有效，ACK=0表示报文不含确认序号信息
         
          // SYN：连接请求序号标志，用于建立连接，SYN=1表示请求连接
         
          
         
         1.   客户端  发送SYN= 1  seq = x 到  服务器 
             此时 客户端不知道自己发送是否正常，     服务器知道自己的接收是正常的
             #  客户端： 发送未知，  接收未知
             #  服务器： 发送未知，  接收OK
             
         2   服务器  发送  SYN = 1  ACK  =1   seq = y  ack =x+1  到 发送 客户端
             此时  服务器知道自己接收正常，不知道自己发送是否正常；  客户端知道自己接收和发送都正常
             
             # 客户端： 发送OK， 接收OK
             # 服务器： 发送未知，接收OK 
             
             
         3   客户端将 ACK = 1  seq = x + 1  ack = y +1 发送到服务器
             此时，服务器就知道自己上一次的发送也是正常的
             
             # 客户端： 发送OK,  接收OK
             # 服务器： 发送OK,  接收OK
             
             
         
         ```

         

     - 当这个TCP连接 不需要的时候，双方就会协商断开，**四次挥手**

       ```javascript
       # 四次挥手的目的 是为了告知双方，要断开连接了，做好准备工作
       // 在挥手之前 两个的状态都是ESTABLISHED 已建立连接的状态
       
        //  FIN：结束标志，用于释放连接，为1表示关闭本方数据流 
       
       1. 客户端发起要断开连接的请求  FIN=1 seq=u   到服务器   此时 客户端的状态变为 FIN-WAIT-1
       
       2. 服务器接收到客户端的信息之后，发送ACK=1 ack=u+1 seq=v  服务器 变为CLOSE-WAIT状态  
          客户端接收到服务器的信息之后 将自己的状态改为 FIN-WAIT-2
       
       3. 服务器发送FIN=1 ACK=1 ack=u+1 seq=w 然后 服务器变为LAST-ACK 最后确认状态
          客户端接收到服务端的信息之后，将自己的状态变为TIME-WAIT 
       
       4. 客户端发送 ACK=1，ack=w+1  seq=u+1  到服务器，服务器收到确认状态变为 CLOSED ，  客户端也变为CLOSED
       
       
       
       简单点 就是说： 1 客户端告诉服务器 我要关闭连接了，此时 状态变为FIN-WAIT-1
                    2 服务器告诉客户端，好的我知道了，我要做个准备，变为CLOSE-WAIT ， 客户端知道了，然后改变自己的状态为FIN-WAIT-2
                    3 服务器告诉客户端，我做好准备了，要关闭了 变为 LAST-WAIT；  客户端知道要关闭了 把自己的状态改为TIME-WAIT
                    4 客户端告诉服务器，你关闭吧，然后等待2MSL 待服务器关闭后，客户端也就关闭了
       ```

     - 问题

       - 1. 为什么握手是三次，挥手是四次

            TCP建立连接时之所以只需要"三次握手"，是因为在第二次"握手"过程中，服务器端发送给客户端的TCP报文是以SYN与ACK作为标志位的。SYN是请求连接标志，表示服务器端同意建立连接；ACK是确认报文，表示告诉客户端，服务器端收到了它的请求报文。

            即SYN建立连接报文与ACK确认接收报文是在同一次"握手"当中传输的，所以"三次握手"不多也不少，正好让双方明确彼此信息互通。

         2. **为什么客户端在TIME-WAIT阶段要等2MSL?**

            为的是确认服务器端是否收到客户端发出的ACK确认报文

            当客户端发出最后的ACK确认报文时，并不能确定服务器端能够收到该段报文。所以客户端在发送完ACK确认报文之后，会设置一个时长为2MSL的计时器。MSL指的是Maximum Segment Lifetime：一段TCP报文在传输过程中的最大生命周期。2MSL即是服务器端发出为FIN报文和客户端发出的ACK确认报文所能保持有效的最大时长。

            服务器端在1MSL内没有收到客户端发出的ACK确认报文，就会再次向客户端发出FIN报文；

   - DNS 域名解析服务

     - DNS服务位于应用层，从上往下第一层。
     - 提供了，域名到IP 地址 之间的解析服务， 或者从IP 反查域名。  详细的介绍可以去Node基础介绍里面去看

4. 各个协议与HTTP协议之间的关系

   ```javascript
   发送端想要访问某个地址 例如 http://www.baidu.com
   1. DNS服务， 让DNS服务查询到  网址对应的IP地址              应用层
   
   2. HTTP协议，将针对这个IP地址，目标web服务器，生成HTTP请求报文   应用层
   
   3. TCP协议，将HTTP协议的请求报文，分割成多个报文段，然后与对方进行三次握手。  传输层
   
   4. IP协议，通过IP地址，查询到对方MAC地址，也就是物理地址， 因为IP协议会变化，MAC地址不常变，所以需要使用ARP协议，来解析地址， IP协议最后一遍中转，一边将数据包传送到接收端     网络层
   
   
   接收端 接收发送端 发送过来的数据的过程
   1. TCP协议，拿到发送端发送的报文段，将报文段重组，恢复成分割前的报文  传输层
   
   2. HTTP协议，对报文进行分析处理   应用层
   ```

   

5.  URI  和 URL

   - URI  统一资源标识符  Uniform Resource Identifier

     - Uniform  规定统一的格式，方便处理不同类型的资源，而不用根据上下文环境来识别资源指定的访问方式   http:,   ftp:   等。
     - Resource  资源， 可标识的任何东西，  可以是单一的，也可是多数的集合体。
     - Identifier:   表示可标识的对象

     ```javascript
     1. ftp://ftp.is.co.za/rfc/rfc1808.txt
     
     2. http://www.ietf.org/rfc/rfc2396.txt
     
     3.ldap://[2001:db8::7]/c=GB?objectClass?one
     
     4. mailto:John.Doe@example.com
     
     5. news:comp.infosystems.www.servers.unix
     
     6. tel:+1-816-555-1212
     
     7. telnet://192.0.2.16:80/
     
     8. urn:oasis:names:specification:docbook:dtd:xml:4.1.2
     ```

   - URL 统一资源定位符

   

   

   

   

   

   

   

   

   

   

   

   

​    