(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{400:function(e,s,t){"use strict";t.r(s);var v=t(33),_=Object(v.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"浅谈-node-js-模块机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#浅谈-node-js-模块机制"}},[e._v("#")]),e._v(" 浅谈 "),t("code",[e._v("Node.js")]),e._v(" 模块机制")]),e._v(" "),t("h3",{attrs:{id:"模块加载机制，-require-时的，在-node-js-中模块加载一般会经历-3-个步骤，路径分析、文件定位、编译执行。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模块加载机制，-require-时的，在-node-js-中模块加载一般会经历-3-个步骤，路径分析、文件定位、编译执行。"}},[e._v("#")]),e._v(" 模块加载机制， require()时的，在 "),t("code",[e._v("Node.js")]),e._v(" 中模块加载一般会经历 3 个步骤，"),t("code",[e._v("路径分析")]),e._v("、"),t("code",[e._v("文件定位")]),e._v("、"),t("code",[e._v("编译执行")]),e._v("。")]),e._v(" "),t("ol",[t("li",[t("strong",[e._v("系统缓存")]),e._v("：模块被执行之后，会进行缓存，"),t("strong",[e._v("缓存是编译和执行之后的对象，核心模块的缓存检查会优先于文件模块的缓存")]),e._v("；首先先去访问缓存里面有没有这个文件，如果有的话，直接加载缓存文件，如果没有的话，就继续访问 2 中有没有。")]),e._v(" "),t("li",[t("strong",[e._v("系统模块")]),e._v("：系统缓存没有的前提下，会访问系统模块，例如"),t("code",[e._v("fs")]),e._v(",  "),t("code",[e._v("path")]),e._v("等内置的模块，省略了 "),t("code",[e._v("路径分析")]),e._v("、"),t("code",[e._v("文件定位")])]),e._v(" "),t("li",[t("strong",[e._v("文件模块")]),e._v("：如果没有在系统内置的模块中找到，那就会去找目录中的文件， 进行省略了 "),t("code",[e._v("路径分析")]),e._v("、"),t("code",[e._v("文件定位")]),e._v("， 找到文件之后，然后"),t("code",[e._v("编译执行")]),e._v("， "),t("strong",[e._v("如果文件没有加上扩展名，会依次按照 "),t("code",[e._v(".js")]),e._v("、"),t("code",[e._v(".json")]),e._v("、"),t("code",[e._v(".node")]),e._v(" 进行扩展名补足尝试")])]),e._v(" "),t("li",[t("strong",[e._v("目录做为模块")]),e._v("：这种情况发生在文件模块加载过程中，也没有找到，但是发现是一个目录的情况，这个时候会将这个目录当作一个 "),t("code",[e._v("包")]),e._v(" 来处理，Node 这块采用了 "),t("code",[e._v("Commonjs")]),e._v("规范，先会在项目根目录查找 "),t("code",[e._v("package.json")]),e._v(" 文件，取出文件中定义的 main 属性 "),t("code",[e._v('("main": "lib/hello.js")')]),e._v(" 描述的入口文件进行加载，也没加载到，则会抛出默认错误: "),t("code",[e._v("Error: Cannot find module 'lib/hello.js'")])]),e._v(" "),t("li",[t("strong",[e._v("node_modules 目录加载")]),e._v("：对于系统模块、路径文件模块都找不到，"),t("code",[e._v("Node.js")]),e._v("会从当前模块的父目录进行查找，直到系统的根目录")])]),e._v(" "),t("p",[e._v("​")]),e._v(" "),t("ul",[t("li",[t("p",[t("strong",[e._v("注意：")]),e._v(" 我们可以通过"),t("code",[e._v("require.cache")]),e._v(" "),t("code",[e._v("Api")]),e._v("的方式查询当前，内粗那种缓存的文件")])]),e._v(" "),t("li",[t("p",[e._v("有一个"),t("code",[e._v("a.js")]),e._v(" 其中有一个变量没有被定义，直接赋值了，例如"),t("code",[e._v('name = "123"')]),e._v(", 并没有"),t("code",[e._v("var")]),e._v(",  "),t("code",[e._v("let")]),e._v(", "),t("code",[e._v("const")]),e._v(" 等定义，那么这个属于整个"),t("code",[e._v("node")]),e._v("的全局变量， 所以"),t("code",[e._v("name")]),e._v("是一个未声明的变量，也就是一个挂在全局的变量，那么在其他地方当然是可以拿到的。")])]),e._v(" "),t("li",[t("p",[t("code",[e._v("exports")]),e._v("和"),t("code",[e._v("module.exports")]),e._v("的区别："),t("code",[e._v("exports")]),e._v("相当于"),t("code",[e._v("module.exports")]),e._v(" 的快捷方式如下所示:")]),e._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//exports 是一个对象， 它的this 指向了 module.exports  ")]),e._v("\n\n所以 我们不能直接将对象赋值给exports 这样就改变了它的"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("this")]),e._v("指向。 就没法用了\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//错误导出")]),e._v("\nexports "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n     name"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"123"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//正确导出")]),e._v("\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"123"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])])])])])}),[],!1,null,null,null);s.default=_.exports}}]);