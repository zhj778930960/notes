(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{562:function(s,e,t){"use strict";t.r(e);var n=t(2),v=Object(n.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"模块加载机制，-require-时的，在-node-js-中模块加载一般会经历-3-个步骤，路径分析、文件定位、编译执行。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模块加载机制，-require-时的，在-node-js-中模块加载一般会经历-3-个步骤，路径分析、文件定位、编译执行。"}},[s._v("#")]),s._v(" 模块加载机制， require()时的，在 "),t("code",[s._v("Node.js")]),s._v(" 中模块加载一般会经历 3 个步骤，"),t("code",[s._v("路径分析")]),s._v("、"),t("code",[s._v("文件定位")]),s._v("、"),t("code",[s._v("编译执行")]),s._v("。")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("系统缓存")]),s._v("：模块被执行之后，会进行缓存，"),t("strong",[s._v("缓存是编译和执行之后的对象，核心模块的缓存检查会优先于文件模块的缓存")]),s._v("；首先先去访问缓存里面有没有这个文件，如果有的话，直接加载缓存文件，如果没有的话，就继续访问 2 中有没有。")]),s._v(" "),t("li",[t("strong",[s._v("系统模块")]),s._v("：系统缓存没有的前提下，会访问系统模块，例如"),t("code",[s._v("fs")]),s._v(",  "),t("code",[s._v("path")]),s._v("等内置的模块，省略了 "),t("code",[s._v("路径分析")]),s._v("、"),t("code",[s._v("文件定位")])]),s._v(" "),t("li",[t("strong",[s._v("文件模块")]),s._v("：如果没有在系统内置的模块中找到，那就会去找目录中的文件， 进行省略了 "),t("code",[s._v("路径分析")]),s._v("、"),t("code",[s._v("文件定位")]),s._v("， 找到文件之后，然后"),t("code",[s._v("编译执行")]),s._v("， "),t("strong",[s._v("如果文件没有加上扩展名，会依次按照 "),t("code",[s._v(".js")]),s._v("、"),t("code",[s._v(".json")]),s._v("、"),t("code",[s._v(".node")]),s._v(" 进行扩展名补足尝试")])]),s._v(" "),t("li",[t("strong",[s._v("目录做为模块")]),s._v("：这种情况发生在文件模块加载过程中，也没有找到，但是发现是一个目录的情况，这个时候会将这个目录当作一个 "),t("code",[s._v("包")]),s._v(" 来处理，Node 这块采用了 "),t("code",[s._v("Commonjs")]),s._v("规范，先会在项目根目录查找 "),t("code",[s._v("package.json")]),s._v(" 文件，取出文件中定义的 main 属性 "),t("code",[s._v('("main": "lib/hello.js")')]),s._v(" 描述的入口文件进行加载，也没加载到，则会抛出默认错误: "),t("code",[s._v("Error: Cannot find module 'lib/hello.js'")])]),s._v(" "),t("li",[t("strong",[s._v("node_modules 目录加载")]),s._v("：对于系统模块、路径文件模块都找不到，"),t("code",[s._v("Node.js")]),s._v("会从当前模块的父目录进行查找，直到系统的根目录")])]),s._v(" "),t("p",[s._v("​")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("注意：")]),s._v(" 我们可以通过"),t("code",[s._v("require.cache")]),s._v(" "),t("code",[s._v("Api")]),s._v("的方式查询当前，内粗那种缓存的文件")])]),s._v(" "),t("li",[t("p",[s._v("有一个"),t("code",[s._v("a.js")]),s._v(" 其中有一个变量没有被定义，直接赋值了，例如"),t("code",[s._v('name = "123"')]),s._v(", 并没有"),t("code",[s._v("var")]),s._v(",  "),t("code",[s._v("let")]),s._v(", "),t("code",[s._v("const")]),s._v(" 等定义，那么这个属于整个"),t("code",[s._v("node")]),s._v("的全局变量， 所以"),t("code",[s._v("name")]),s._v("是一个未声明的变量，也就是一个挂在全局的变量，那么在其他地方当然是可以拿到的。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("exports")]),s._v("和"),t("code",[s._v("module.exports")]),s._v("的区别："),t("code",[s._v("exports")]),s._v("相当于"),t("code",[s._v("module.exports")]),s._v(" 的快捷方式如下所示:")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//exports 是一个对象， 它的this 指向了 module.exports  ")]),s._v("\n\n所以 我们不能直接将对象赋值给exports 这样就改变了它的"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),s._v("指向。 就没法用了\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//错误导出")]),s._v("\nexports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//正确导出")]),s._v("\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])])])])])}),[],!1,null,null,null);e.default=v.exports}}]);